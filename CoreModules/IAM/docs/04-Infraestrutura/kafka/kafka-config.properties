# Configuração do Apache Kafka para o módulo IAM do INNOVABIZ
# ------------------------------------------------------------------------

# Configurações básicas
broker.id=0
num.network.threads=8
num.io.threads=16
socket.send.buffer.bytes=102400
socket.receive.buffer.bytes=102400
socket.request.max.bytes=104857600
log.dirs=/var/lib/kafka/data
num.partitions=12
num.recovery.threads.per.data.dir=2
offsets.topic.replication.factor=3
transaction.state.log.replication.factor=3
transaction.state.log.min.isr=2
default.replication.factor=3
min.insync.replicas=2

# Configurações de segurança
listeners=SASL_SSL://0.0.0.0:9092
advertised.listeners=SASL_SSL://kafka:9092
security.inter.broker.protocol=SASL_SSL
sasl.mechanism.inter.broker.protocol=PLAIN
sasl.enabled.mechanisms=PLAIN,SCRAM-SHA-256,SCRAM-SHA-512
authorizer.class.name=kafka.security.authorizer.AclAuthorizer
ssl.keystore.location=/etc/kafka/secrets/kafka.server.keystore.jks
ssl.keystore.password=${KEYSTORE_PASSWORD}
ssl.key.password=${KEY_PASSWORD}
ssl.truststore.location=/etc/kafka/secrets/kafka.server.truststore.jks
ssl.truststore.password=${TRUSTSTORE_PASSWORD}
ssl.client.auth=required
ssl.protocol=TLSv1.3
ssl.enabled.protocols=TLSv1.3
ssl.endpoint.identification.algorithm=HTTPS

# Configurações de auditoria e monitoramento
confluent.metrics.reporter.bootstrap.servers=kafka:9092
confluent.metrics.reporter.sasl.mechanism=PLAIN
confluent.metrics.reporter.security.protocol=SASL_SSL
confluent.metrics.reporter.topic.replicas=3
confluent.metrics.enable=true
confluent.monitoring.interceptor.topic.partitions=12
confluent.monitoring.interceptor.topic.replication=3

# Configurações de retenção e gerenciamento de dados
log.retention.hours=168
log.segment.bytes=1073741824
log.retention.check.interval.ms=300000
log.cleaner.enable=true
log.cleaner.min.compaction.lag.ms=60000
log.cleanup.policy=delete
retention.ms=604800000

# Configurações de gerenciamento de memória e desempenho
replica.fetch.max.bytes=10485760
message.max.bytes=10485760
max.request.size=10485760
max.connections.per.ip=2000
max.connections.per.ip.overrides=127.0.0.1:10000
queued.max.requests=1000
compression.type=lz4
background.threads=10
num.replica.fetchers=4
replica.lag.time.max.ms=30000
group.max.session.timeout.ms=300000
group.min.session.timeout.ms=6000

# Configurações de tolerância a falhas e recuperação
controlled.shutdown.enable=true
auto.leader.rebalance.enable=true
unclean.leader.election.enable=false
transaction.abort.timed.out.transaction.cleanup.interval.ms=60000

# Configurações regionais (serão sobrescritas pelas configurações específicas de cada região)
delete.topic.enable=true
auto.create.topics.enable=false

# Monitoramento e telemetria
jmx.port=9999
metric.reporters=io.confluent.metrics.reporter.ConfluentMetricsReporter
confluent.telemetry.enabled=true
confluent.telemetry.api.key=${TELEMETRY_API_KEY}
confluent.telemetry.api.secret=${TELEMETRY_API_SECRET}

# Integração com OpenTelemetry
confluent.opentelemetry.enabled=true
confluent.opentelemetry.endpoint=http://innovabiz-otel-collector:4318/v1/traces
