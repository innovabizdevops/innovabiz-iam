# ============================================================================
# INNOVABIZ IAM - WebAuthn Backend Environment Variables
# ============================================================================
# Version: 1.0.0
# Date: 31/07/2025
# Author: Equipe de Segurança INNOVABIZ
# Classification: Confidencial - Interno
# 
# Description: Variáveis de ambiente para configuração do backend WebAuthn
# Standards: W3C WebAuthn Level 3, FIDO2 CTAP2.1, NIST SP 800-63B
# Compliance: PCI DSS 4.0, GDPR/LGPD, PSD2, ISO 27001
# ============================================================================

# ============================================================================
# CONFIGURAÇÕES GERAIS
# ============================================================================

# Ambiente de execução (development, staging, production)
NODE_ENV=development

# Porta do servidor
PORT=3000

# Versão da aplicação
APP_VERSION=1.0.0

# ============================================================================
# CONFIGURAÇÕES DE LOGGING
# ============================================================================

# Nível de log (error, warn, info, debug, verbose)
LOG_LEVEL=info

# Formato de log (json, simple)
LOG_FORMAT=json

# ============================================================================
# CONFIGURAÇÕES DO BANCO DE DADOS POSTGRESQL
# ============================================================================

# Host do PostgreSQL
DB_HOST=localhost

# Porta do PostgreSQL
DB_PORT=5432

# Nome do banco de dados
DB_NAME=innovabiz_iam

# Usuário do banco de dados
DB_USER=postgres

# Senha do banco de dados
DB_PASSWORD=your_secure_password_here

# Tamanho máximo do pool de conexões
DB_POOL_MAX=20

# Timeout de conexão idle (ms)
DB_IDLE_TIMEOUT=30000

# Timeout de conexão (ms)
DB_CONNECTION_TIMEOUT=2000

# Usar SSL (true/false)
DB_SSL=false

# Rejeitar certificados não autorizados (true/false)
DB_SSL_REJECT_UNAUTHORIZED=true

# ============================================================================
# CONFIGURAÇÕES DO REDIS
# ============================================================================

# Host do Redis
REDIS_HOST=localhost

# Porta do Redis
REDIS_PORT=6379

# Senha do Redis (opcional)
REDIS_PASSWORD=

# Banco de dados Redis (0-15)
REDIS_DB=0

# ============================================================================
# CONFIGURAÇÕES DO KAFKA (OPCIONAL)
# ============================================================================

# Brokers do Kafka (separados por vírgula)
KAFKA_BROKERS=localhost:9092

# Client ID do Kafka
KAFKA_CLIENT_ID=innovabiz-iam-webauthn

# Usar SSL (true/false)
KAFKA_SSL=false

# Mecanismo SASL (plain, scram-sha-256, scram-sha-512)
KAFKA_SASL_MECHANISM=

# Usuário SASL
KAFKA_SASL_USERNAME=

# Senha SASL
KAFKA_SASL_PASSWORD=

# Tópico para eventos de auditoria
WEBAUTHN_AUDIT_TOPIC=webauthn-audit-events

# ============================================================================
# CONFIGURAÇÕES WEBAUTHN
# ============================================================================

# Nome do Relying Party
WEBAUTHN_RP_NAME=INNOVABIZ IAM

# ID do Relying Party (domínio)
WEBAUTHN_RP_ID=innovabiz.com

# Origens permitidas (separadas por vírgula)
WEBAUTHN_ORIGINS=https://innovabiz.com,https://app.innovabiz.com,https://api.innovabiz.com

# Timeout para operações WebAuthn (ms)
WEBAUTHN_TIMEOUT=60000

# Preferência de attestation (none, indirect, direct, enterprise)
WEBAUTHN_ATTESTATION=indirect

# Anexo do autenticador (platform, cross-platform)
WEBAUTHN_AUTHENTICATOR_ATTACHMENT=

# Verificação de usuário (required, preferred, discouraged)
WEBAUTHN_USER_VERIFICATION=preferred

# Chave residente (required, preferred, discouraged)
WEBAUTHN_RESIDENT_KEY=preferred

# Tamanho do challenge (bytes)
WEBAUTHN_CHALLENGE_LENGTH=32

# ============================================================================
# CONFIGURAÇÕES DE RATE LIMITING
# ============================================================================

# Limite de registros por usuário (por janela de tempo)
WEBAUTHN_RATE_LIMIT_REG_USER=5

# Limite de autenticações por usuário (por janela de tempo)
WEBAUTHN_RATE_LIMIT_AUTH_USER=10

# Limite de registros por IP (por janela de tempo)
WEBAUTHN_RATE_LIMIT_REG_IP=20

# Limite de autenticações por IP (por janela de tempo)
WEBAUTHN_RATE_LIMIT_AUTH_IP=50

# Janela de tempo para rate limiting (minutos)
WEBAUTHN_RATE_LIMIT_WINDOW=15

# ============================================================================
# CONFIGURAÇÕES DE SEGURANÇA
# ============================================================================

# Validar origem (true/false)
WEBAUTHN_REQUIRE_ORIGIN_VALIDATION=true

# Validar RP ID (true/false)
WEBAUTHN_REQUIRE_RPID_VALIDATION=true

# Permitir origens inseguras em desenvolvimento (true/false)
WEBAUTHN_ALLOW_INSECURE_ORIGINS=false

# Threshold para anomalias de sign count
WEBAUTHN_SIGN_COUNT_ANOMALY_THRESHOLD=0

# ============================================================================
# CONFIGURAÇÕES DE CACHE
# ============================================================================

# TTL para challenges (segundos)
WEBAUTHN_CHALLENGE_TTL=300

# TTL para cache de credenciais (segundos)
WEBAUTHN_CREDENTIAL_CACHE_TTL=600

# TTL para cache de credenciais de usuário (segundos)
WEBAUTHN_USER_CREDENTIALS_CACHE_TTL=300

# ============================================================================
# CONFIGURAÇÕES DE COMPLIANCE
# ============================================================================

# AAL mínimo padrão (AAL1, AAL2, AAL3)
WEBAUTHN_MINIMUM_AAL_DEFAULT=AAL1

# AAL mínimo para operações financeiras
WEBAUTHN_MINIMUM_AAL_FINANCIAL=AAL2

# AAL mínimo para operações administrativas
WEBAUTHN_MINIMUM_AAL_ADMIN=AAL3

# Exigir verificação de usuário no registro (true/false)
WEBAUTHN_REQUIRE_UV_REGISTRATION=false

# Exigir verificação de usuário na autenticação (true/false)
WEBAUTHN_REQUIRE_UV_AUTHENTICATION=false

# Exigir verificação de usuário em step-up (true/false)
WEBAUTHN_REQUIRE_UV_STEP_UP=true

# Exigir attestation no registro (true/false)
WEBAUTHN_REQUIRE_ATTESTATION_REGISTRATION=false

# Exigir verificação de attestation (true/false)
WEBAUTHN_REQUIRE_ATTESTATION_VERIFICATION=false

# ============================================================================
# CONFIGURAÇÕES DE OBSERVABILIDADE
# ============================================================================

# Habilitar métricas (true/false)
WEBAUTHN_METRICS_ENABLED=true

# Prefixo para métricas
WEBAUTHN_METRICS_PREFIX=innovabiz_webauthn_

# Incluir credential ID nos logs (true/false)
WEBAUTHN_LOG_INCLUDE_CREDENTIAL_ID=false

# Incluir dados sensíveis nos logs em desenvolvimento (true/false)
WEBAUTHN_LOG_INCLUDE_SENSITIVE=false

# Habilitar tracing (true/false)
WEBAUTHN_TRACING_ENABLED=false

# Nome do serviço para tracing
WEBAUTHN_TRACING_SERVICE_NAME=innovabiz-iam-webauthn

# Taxa de amostragem para tracing (0.0 - 1.0)
WEBAUTHN_TRACING_SAMPLE_RATE=0.1

# ============================================================================
# CONFIGURAÇÕES DE HEALTH CHECK
# ============================================================================

# Habilitar health check (true/false)
WEBAUTHN_HEALTH_CHECK_ENABLED=true

# Intervalo de health check (ms)
WEBAUTHN_HEALTH_CHECK_INTERVAL=30000

# Timeout de health check (ms)
WEBAUTHN_HEALTH_CHECK_TIMEOUT=5000

# ============================================================================
# CONFIGURAÇÕES DE ALERTAS
# ============================================================================

# Habilitar alertas (true/false)
WEBAUTHN_ALERTS_ENABLED=false

# ============================================================================
# CONFIGURAÇÕES DE DESENVOLVIMENTO
# ============================================================================

# Habilitar modo debug (true/false)
DEBUG=false

# Habilitar hot reload (true/false)
HOT_RELOAD=true

# ============================================================================
# CONFIGURAÇÕES DE PRODUÇÃO
# ============================================================================

# Cluster mode (true/false)
CLUSTER_MODE=false

# Número de workers (0 = auto)
CLUSTER_WORKERS=0

# ============================================================================
# CONFIGURAÇÕES DE BACKUP E RECUPERAÇÃO
# ============================================================================

# Habilitar backup automático (true/false)
BACKUP_ENABLED=false

# Cronograma de backup (cron expression)
BACKUP_SCHEDULE=0 2 * * *

# Retenção de backups em dias
BACKUP_RETENTION_DAYS=30

# ============================================================================
# CONFIGURAÇÕES DE MONITORAMENTO EXTERNO
# ============================================================================

# URL do Grafana
GRAFANA_URL=http://localhost:3001

# URL do Prometheus
PROMETHEUS_URL=http://localhost:9090

# URL do Jaeger (tracing)
JAEGER_URL=http://localhost:14268

# ============================================================================
# CONFIGURAÇÕES DE NOTIFICAÇÃO
# ============================================================================

# URL do webhook para alertas
ALERT_WEBHOOK_URL=

# Email para notificações
ALERT_EMAIL=

# Canal do Slack para alertas
ALERT_SLACK_CHANNEL=

# ============================================================================
# CONFIGURAÇÕES DE INTEGRAÇÃO
# ============================================================================

# URL do serviço de usuários
USER_SERVICE_URL=http://localhost:3001

# URL do serviço de tenants
TENANT_SERVICE_URL=http://localhost:3002

# URL do API Gateway
API_GATEWAY_URL=http://localhost:8080

# ============================================================================
# CONFIGURAÇÕES DE TESTE
# ============================================================================

# Banco de dados de teste
TEST_DB_NAME=innovabiz_iam_test

# Redis de teste
TEST_REDIS_DB=1

# Modo de teste (true/false)
TEST_MODE=false

# ============================================================================
# CONFIGURAÇÕES DE SEGURANÇA AVANÇADA
# ============================================================================

# Chave secreta para JWT (gerar uma chave forte)
JWT_SECRET=your_jwt_secret_key_here_make_it_very_long_and_secure

# Algoritmo JWT (HS256, RS256, ES256)
JWT_ALGORITHM=HS256

# Expiração do JWT
JWT_EXPIRES_IN=1h

# Issuer do JWT
JWT_ISSUER=innovabiz-iam

# Audience do JWT
JWT_AUDIENCE=innovabiz-services

# Chave de criptografia (32 bytes em hex)
ENCRYPTION_KEY=your_32_byte_encryption_key_in_hex_format_here

# ============================================================================
# NOTAS IMPORTANTES
# ============================================================================

# 1. Nunca commitar este arquivo com valores reais em produção
# 2. Usar secrets management em produção (AWS Secrets Manager, Azure Key Vault, etc.)
# 3. Rotacionar chaves regularmente
# 4. Usar HTTPS em produção
# 5. Configurar firewall adequadamente
# 6. Monitorar logs de segurança
# 7. Realizar auditorias regulares
# 8. Manter dependências atualizadas
# 9. Implementar backup e disaster recovery
# 10. Testar configurações em ambiente de staging primeiro